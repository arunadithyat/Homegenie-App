// const enabled_doctypes = ["Customer","Opportunity","Lead","Job Applicant","Prospect"];

frappe.ui.form.on("Job Applicant", {
    refresh: function (frm) {   
        frappe.db.get_doc("Smartflo Settings").then(doc => {
            let enabled_doctypes = doc.enabled_doctypes.map(row => row.enabled_doctype);
            let enabled = doc.enabled
               
            if (enabled && enabled_doctypes.includes(frm.doctype) && !frm.doc.__islocal) {
                $('#smart-flo').remove();
                let icon = $(`
                        <span id="smart-flo" style="display: flex; align-items: center; cursor: pointer;">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 194 115">
                            <path d="M0 0 C0.82411377 0.00161133 1.64822754 0.00322266 2.49731445 0.00488281 C12.84881867 0.21056187 21.73879661 3.42767265 30.75 8.375 C30.75 9.035 30.75 9.695 30.75 10.375 C29.76257813 10.21644531 28.77515625 10.05789063 27.7578125 9.89453125 C10.67247508 7.47889967 -3.91942352 10.45989688 -18.25 20.375 C-26.37530865 26.5628282 -32.3004195 34.1848328 -38.25 42.375 C-42.11567683 41.5315796 -45.45919093 39.97619875 -49.03125 38.3125 C-56.84633573 35.0103511 -66.69647975 35.05664016 -74.625 37.9375 C-83.1169791 41.9534113 -87.70045993 47.11541027 -91.33984375 55.7265625 C-94.31702427 64.38977449 -93.48830088 71.93579164 -90.25 80.375 C-86.16031398 88.09996248 -79.4619947 93.58602067 -71.25 96.375 C-64.01847365 98.36366975 -57.29224829 97.11295384 -50.1171875 95.51953125 C-46.52097575 95.33825082 -45.07191796 96.2024161 -42.25 98.375 C-39.90831236 101.88753146 -39.75376323 103.23969356 -40.25 107.375 C-42.1300369 110.8898516 -44.26676031 112.67047978 -47.875 114.1875 C-61.71397864 118.16763601 -76.06166413 115.49136689 -88.4375 108.6875 C-99.70773826 101.38438561 -107.25081181 90.88053628 -110.94921875 77.92578125 C-112.7826952 62.37694853 -110.9872337 49.05547815 -101.25 36.375 C-100.81042969 35.76011719 -100.37085937 35.14523438 -99.91796875 34.51171875 C-92.46067972 24.81939209 -80.09803236 19.3404013 -68.25 17.375 C-59.84324714 16.68439787 -50.88980091 17.55509955 -43.25 21.375 C-42.97414063 20.78203125 -42.69828125 20.1890625 -42.4140625 19.578125 C-38.85644835 12.84492238 -32.96764653 9.40089748 -26.375 6.0625 C-25.3857251 5.55638184 -25.3857251 5.55638184 -24.37646484 5.04003906 C-16.50002649 1.22431654 -8.70167567 -0.01798424 0 0 Z " fill="#ED6D02" transform="translate(111.25,-0.375)"/>
                            <path d="M0 0 C8.99328001 6.6763672 16.27995366 15.95291294 19 27 C19.44217721 31.29934518 19.46464837 35.55594044 19.4375 39.875 C19.45748047 40.99519531 19.47746094 42.11539063 19.49804688 43.26953125 C19.49078023 55.72456116 15.10315553 64.65128171 7 74 C0.81545853 80.03069716 -5.93918082 83.9787218 -14 87 C-14.65355469 87.24621094 -15.30710938 87.49242188 -15.98046875 87.74609375 C-27.92225905 91.43811847 -41.81810551 89.26018757 -52.73828125 83.57421875 C-56.83078215 80.98207824 -60.59682341 78.28392349 -63 74 C-63.5675684 69.95607514 -63.70029583 67.95040148 -61.25 64.625 C-58.91167445 62.93620933 -57.83896081 62.28389608 -55 62 C-52.1953125 63.14453125 -52.1953125 63.14453125 -49.125 64.8125 C-39.9676815 69.74246303 -31.34951998 71.46668343 -21 70 C-13.42480008 67.62429556 -7.2456472 63.7761654 -3 57 C-2.59007812 56.37867187 -2.18015625 55.75734375 -1.7578125 55.1171875 C2.09026139 48.13757762 2.25054524 39.73954955 1 32 C-1.40098171 24.42375737 -5.21306161 18.25239708 -12 14 C-12.93199219 13.38511719 -12.93199219 13.38511719 -13.8828125 12.7578125 C-21.96241357 8.30327959 -32.79562427 9.07724697 -41.625 10.8125 C-45.08018717 11.00445484 -45.80025825 10.92868093 -48.5 9.0625 C-51.42609351 5.47803544 -51.42609351 5.47803544 -51.625 1.9375 C-50.9262502 -2.46462371 -50.33076875 -3.26072984 -47 -6 C-31.84034612 -12.88608007 -13.32463122 -9.19448723 0 0 Z " fill="#EE7202" transform="translate(175,22)"/>
                            <path d="M0 0 C-0.33 4.29 -0.66 8.58 -1 13 C-0.21625 12.195625 0.5675 11.39125 1.375 10.5625 C4.53900014 7.47383319 6.02252577 6.81246106 10.3125 6.625 C13.86905532 6.68810017 14.93115282 6.95644362 18.0625 8.9375 C20.68033685 13.07537115 20.90897368 16.22788818 20 21 C17.80794622 25.38410756 15.56884617 28.13092657 11 30 C6.59936164 30.72449534 3.87007348 30.55536605 0.0625 28.125 C-2 26 -2 26 -3 24 C-3.66 25.98 -4.32 27.96 -5 30 C-7.31 30 -9.62 30 -12 30 C-11.01 24.39 -10.02 18.78 -9 13 C-9.99 13.33 -10.98 13.66 -12 14 C-12.99 19.28 -13.98 24.56 -15 30 C-17.31 30 -19.62 30 -22 30 C-21.69188262 27.54104382 -21.37871012 25.08291693 -21.0625 22.625 C-20.97548828 21.92632812 -20.88847656 21.22765625 -20.79882812 20.5078125 C-20.11328125 15.2265625 -20.11328125 15.2265625 -19 13 C-23.95 13 -28.9 13 -34 13 C-34.33 16.63 -34.66 20.26 -35 24 C-33.68 23.67 -32.36 23.34 -31 23 C-30.34 20.36 -29.68 17.72 -29 15 C-25.535 14.505 -25.535 14.505 -22 14 C-23.10707976 24.89900934 -23.10707976 24.89900934 -26.625 28.1875 C-31.03227793 30.55437148 -33.05764122 30.71743918 -38 30 C-40.2578125 28.35546875 -40.2578125 28.35546875 -42 26 C-42.171875 22.984375 -42.171875 22.984375 -41.75 19.75 C-41.62109375 18.67234375 -41.4921875 17.5946875 -41.359375 16.484375 C-41.18148437 15.25460938 -41.18148437 15.25460938 -41 14 C-42.65 14.33 -44.3 14.66 -46 15 C-46.28875 16.175625 -46.5775 17.35125 -46.875 18.5625 C-47.81850737 22.40392284 -48.90364207 26.19959963 -50 30 C-53.91652632 30.08714316 -57.83280311 30.14043985 -61.75 30.1875 C-62.86117187 30.21263672 -63.97234375 30.23777344 -65.1171875 30.26367188 C-66.18710938 30.27333984 -67.25703125 30.28300781 -68.359375 30.29296875 C-69.34389648 30.3086792 -70.32841797 30.32438965 -71.34277344 30.34057617 C-74.39282409 29.94965182 -75.74113723 29.03157056 -78 27 C-78 27.99 -78 28.98 -78 30 C-79.98 30 -81.96 30 -84 30 C-85.55373847 26.89252306 -84.58528628 24.25773473 -84.0625 20.875 C-83.86785156 19.59367187 -83.67320313 18.31234375 -83.47265625 16.9921875 C-83.23869141 15.51105469 -83.23869141 15.51105469 -83 14 C-84.32 14.33 -85.64 14.66 -87 15 C-87.99 19.95 -88.98 24.9 -90 30 C-92.31 30 -94.62 30 -97 30 C-96.34 24.39 -95.68 18.78 -95 13 C-96.32 13.33 -97.64 13.66 -99 14 C-99.99 19.28 -100.98 24.56 -102 30 C-104.31 30 -106.62 30 -109 30 C-109.33 29.01 -109.66 28.02 -110 27 C-110.55816406 27.4846875 -111.11632812 27.969375 -111.69140625 28.46875 C-115.553592 31.0304705 -119.53072471 30.78699678 -124 30 C-127.125 27.6875 -127.125 27.6875 -129 25 C-129 24.01 -129 23.02 -129 22 C-126.69 22 -124.38 22 -122 22 C-122 22.66 -122 23.32 -122 24 C-119.69 24 -117.38 24 -115 24 C-115 23.34 -115 22.68 -115 22 C-116.8871875 21.566875 -116.8871875 21.566875 -118.8125 21.125 C-121.8539399 20.42696461 -123.30669878 19.79553415 -126 18 C-126.5 14.625 -126.5 14.625 -126 11 C-123.80253778 8.14329912 -122.14253769 7.17904064 -118.58203125 6.62109375 C-114.29958209 6.42499933 -111.85438724 6.34903829 -108.375 9 C-107.694375 9.99 -107.694375 9.99 -107 11 C-106.34 9.68 -105.68 8.36 -105 7 C-98.66666667 7 -92.33333333 7 -86 7 C-84.845 6.9175 -83.69 6.835 -82.5 6.75 C-79 7 -79 7 -76.5625 8.5 C-74.28970962 12.13646461 -74.71718836 14.75782535 -75 19 C-74.34 18.525625 -73.68 18.05125 -73 17.5625 C-69.2066972 15.58682146 -66.24475932 15.35972537 -62 15 C-62.495 14.01 -62.495 14.01 -63 13 C-65.21674869 13.47501758 -67.03857099 14.0198699 -69.0625 15.0625 C-71 16 -71 16 -74 16 C-73.76481427 12.47221403 -73.63136193 10.59190181 -71 8.125 C-66.92022013 6.59508255 -63.30458824 6.26051377 -59 7 C-55.9375 9 -55.9375 9 -54 11 C-53.67 9.68 -53.34 8.36 -53 7 C-48.33333333 7 -43.66666667 7 -39 7 C-39 5.35 -39 3.7 -39 2 C-36.69 2 -34.38 2 -32 2 C-32 3.65 -32 5.3 -32 7 C-27.38 7 -22.76 7 -18 7 C-17.34 5.35 -16.68 3.7 -16 2 C-11.50182955 -1.38375885 -5.30518828 -0.11533018 0 0 Z M-9 5 C-9.66 5.66 -10.32 6.32 -11 7 C-10.01 7 -9.02 7 -8 7 C-8.33 6.34 -8.66 5.68 -9 5 Z M-119 12 C-119 12.99 -119 13.98 -119 15 C-118.38511719 15.20496094 -117.77023438 15.40992188 -117.13671875 15.62109375 C-112.06835938 17.31054688 -112.06835938 17.31054688 -107 19 C-107 17.68 -107 16.36 -107 15 C-109.31 15 -111.62 15 -114 15 C-114.33 14.01 -114.66 13.02 -115 12 C-116.32 12 -117.64 12 -119 12 Z M5.1875 15.1875 C3.96210762 18.08974511 3.65456502 19.89108521 4 23 C5.11258591 24.32745166 5.11258591 24.32745166 7.9375 24.25 C8.948125 24.1675 9.95875 24.085 11 24 C13.43769218 20.34346173 13.23944439 18.30999899 13 14 C11.94945399 12.75339676 11.94945399 12.75339676 9.625 12.625 C6.81325376 12.72665433 6.81325376 12.72665433 5.1875 15.1875 Z M-3 15 C-2 18 -2 18 -2 18 Z M-56 18 C-56 19.65 -56 21.3 -56 23 C-55.67 23 -55.34 23 -55 23 C-55 21.35 -55 19.7 -55 18 C-55.33 18 -55.66 18 -56 18 Z M-77 21 C-76 23 -76 23 -76 23 Z M-70 23 C-70 23.66 -70 24.32 -70 25 C-68.02 24.67 -66.04 24.34 -64 24 C-63.67 22.68 -63.34 21.36 -63 20 C-65.94271444 20 -67.61500243 21.36815955 -70 23 Z " fill="#000000" transform="translate(152,48)"/>
                            <path d="M0 0 C0.33 0 0.66 0 1 0 C1.01458252 0.57331055 1.02916504 1.14662109 1.04418945 1.73730469 C1.52886879 18.81582889 2.19330805 35.19330805 15 48 C23.50184699 54.50798043 34.25566446 57.97675778 45 57 C48.05245583 56.40999511 51.09763115 55.81857802 54.1328125 55.14453125 C57.72902425 54.96325082 59.17808204 55.8274161 62 58 C64.34168764 61.51253146 64.49623677 62.86469356 64 67 C62.1199631 70.5148516 59.98323969 72.29547978 56.375 73.8125 C42.53602136 77.79263601 28.18833587 75.11636689 15.8125 68.3125 C4.54226174 61.00938561 -3.00081181 50.50553628 -6.69921875 37.55078125 C-8.27236106 24.20971721 -7.55139715 11.52363894 0 0 Z " fill="#F8AB00" transform="translate(7,40)"/>
                            <path d="M0 0 C8.92699681 6.62716034 16.41450345 15.97738736 19 27 C19.34495496 31.50874734 19.28432255 35.98161424 19.1875 40.5 C19.16719727 42.30597656 19.16719727 42.30597656 19.14648438 44.1484375 C19.11135352 47.09942973 19.06215996 50.04947412 19 53 C18.34 53 17.68 53 17 53 C16.01 55.97 15.02 58.94 14 62 C13.34 62 12.68 62 12 62 C11.97421875 60.85144531 11.9484375 59.70289062 11.921875 58.51953125 C11.45450889 44.04993909 9.53219806 30.90393283 -0.8828125 20.03515625 C-9.3931481 12.14223715 -17.34617824 9.80545068 -28.875 9.875 C-29.93726807 9.87246216 -29.93726807 9.87246216 -31.02099609 9.86987305 C-34.6521327 9.88534783 -38.06871675 10.08883771 -41.625 10.8125 C-45.08018717 11.00445484 -45.80025825 10.92868093 -48.5 9.0625 C-51.42609351 5.47803544 -51.42609351 5.47803544 -51.625 1.9375 C-50.9262502 -2.46462371 -50.33076875 -3.26072984 -47 -6 C-31.84034612 -12.88608007 -13.32463122 -9.19448723 0 0 Z " fill="#F8AB00" transform="translate(175,22)"/>
                            <path d="M0 0 C0.82411377 0.00161133 1.64822754 0.00322266 2.49731445 0.00488281 C12.84881867 0.21056187 21.73879661 3.42767265 30.75 8.375 C30.75 9.035 30.75 9.695 30.75 10.375 C29.76257813 10.21644531 28.77515625 10.05789063 27.7578125 9.89453125 C10.67247508 7.47889967 -3.91942352 10.45989688 -18.25 20.375 C-24.95835734 25.48374903 -30.12612316 31.41226154 -35.02783203 38.20947266 C-36.06005269 39.62935798 -37.15029607 41.00671454 -38.25 42.375 C-38.91 42.375 -39.57 42.375 -40.25 42.375 C-43.66341355 36.42905382 -45.50762112 31.30735019 -45.25 24.375 C-43.06526902 17.09256341 -36.94428264 11.79833443 -30.484375 8.15625 C-29.09994172 7.4256448 -27.7091964 6.7068795 -26.3125 6 C-25.65677002 5.66629395 -25.00104004 5.33258789 -24.32543945 4.98876953 C-16.46869196 1.21605656 -8.66551347 -0.0179095 0 0 Z " fill="#F8AF06" transform="translate(111.25,-0.375)"/>
                            <path d="M0 0 C-0.33 4.29 -0.66 8.58 -1 13 C-0.21625 12.195625 0.5675 11.39125 1.375 10.5625 C4.53900014 7.47383319 6.02252577 6.81246106 10.3125 6.625 C13.86905532 6.68810017 14.93115282 6.95644362 18.0625 8.9375 C20.68033685 13.07537115 20.90897368 16.22788818 20 21 C17.80794622 25.38410756 15.56884617 28.13092657 11 30 C6.59936164 30.72449534 3.87007348 30.55536605 0.0625 28.125 C-2 26 -2 26 -3 24 C-3.66 25.98 -4.32 27.96 -5 30 C-7.31 30 -9.62 30 -12 30 C-11.01 24.39 -10.02 18.78 -9 13 C-9.99 13.33 -10.98 13.66 -12 14 C-12.99 19.28 -13.98 24.56 -15 30 C-17.31 30 -19.62 30 -22 30 C-21.69188262 27.54104382 -21.37871012 25.08291693 -21.0625 22.625 C-20.97548828 21.92632812 -20.88847656 21.22765625 -20.79882812 20.5078125 C-20.11328125 15.2265625 -20.11328125 15.2265625 -19 13 C-19.99 13 -20.98 13 -22 13 C-22 11.02 -22 9.04 -22 7 C-20.68 7 -19.36 7 -18 7 C-17.7525 6.21625 -17.505 5.4325 -17.25 4.625 C-14.06391018 -2.06578862 -6.32592537 -0.13752012 0 0 Z M-9 5 C-9.66 5.66 -10.32 6.32 -11 7 C-10.01 7 -9.02 7 -8 7 C-8.33 6.34 -8.66 5.68 -9 5 Z M5.1875 15.1875 C3.96210762 18.08974511 3.65456502 19.89108521 4 23 C5.11258591 24.32745166 5.11258591 24.32745166 7.9375 24.25 C8.948125 24.1675 9.95875 24.085 11 24 C13.43769218 20.34346173 13.23944439 18.30999899 13 14 C11.94945399 12.75339676 11.94945399 12.75339676 9.625 12.625 C6.81325376 12.72665433 6.81325376 12.72665433 5.1875 15.1875 Z M-3 15 C-2 18 -2 18 -2 18 Z " fill="#F6A500" transform="translate(152,48)"/>
                            <path d="M0 0 C0.33 0 0.66 0 1 0 C1 4.62 1 9.24 1 14 C-1 11 -1 11 -2 9 C-2.99 9.495 -2.99 9.495 -4 10 C-3.4359146 6.05140217 -2.2568294 3.29120954 0 0 Z " fill="#F39200" transform="translate(7,40)"/>
                            </svg>   
                            </span>
                        `);

                icon.click(function () {
                    frappe.call({
                        method: 'smartflo.api.initiate_call',
                        args: {
                            doc: frm.doc,
                        },
                        async: true,
                        freeze: true,
                        freeze_message: "Initiating call...",
                        callback: function (response) {
                            if (response && response.message) {
                                let indicator = response.message.success ? 'green' : 'red';
                                frappe.show_alert({
                                    message: __(response.message.message || "Unknown response"),
                                    indicator: indicator
                                }, 5);
                            } else {
                                frappe.show_alert({
                                    message: __("App is Not Installed or Configured"),
                                    indicator: 'red'
                                }, 5);
                            }                            
                        }
                    });
                });
                frm.page.wrapper.find('.page-actions').prepend(icon);
            }
        });   
    },

});  
